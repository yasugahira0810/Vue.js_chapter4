# CHAPTER4 Vue Routerを活用したアプリケーション開発

## *はじめに*

### *注意事項*

- *このリポジトリは[[秋葉原] 基礎から学ぶVue.js 輪読会(Vuex + VueRouter)](https://weeyble-js.connpass.com/event/100388/)の発表資料として用意したリポジトリです。*
- *書籍の要約は正体、担当者の理解で書いているところは斜体で記載しています。*
- *「サンプルあり」と記載のある箇所は、サンプルを動かしながら説明します。*
- *権利関係で問題があれば、対応するのでご指摘ください。*
- *各SECTIONのサンプルプログラムについて、（中身は十分理解できてませんが）とりあえずエラーが出ない状態まで実装したつもりなので、書籍の内容で不明点があれば、このリポジトリを参照してください。コミットログを見てもらえば、どこコミットでどのSECTIONの内容を実装しているかだいたいわかると思います。*
- *git cloneしてnpm installしてnpm run devとすれば多分動くと思います。*

### 8章の構成

8章は41〜46の6節の構成。

- 41節：Vuexの概要、メリットの説明。
- 42節：Vuexの中心となるストアについて、シンプルな例で説明。（43節を読む上での最低限の前提知識の説明）
- 43節：Vuexアーキテクチャの説明。8章で一番大事。
- 44節：コンポーネントでストアを使う具体例の説明。
- 45節：ストアが肥大化した時の対策の説明
- 46節：落ち穂拾い的な説明

-------------------

## 4.1 Vue Routerによるシングルページアプリケーション

- Vuexとは、データとその状態(state)を管理する**状態管理のための拡張ライブラリ**。
- CHAPTER5「コンポーネントでUI部品を作る」でコンポーネント間のデータのやり取りの仕方を学んだ。シンプルなアプリケーションはCHAPTER5の内容で十分だが、コンポーネントを構造化したりアプリケーションの規模が大きくなると管理が難しくなってくる。
- Vuexを導入することで、面倒なデータ管理から解放される。加えて、整合性も保ちやすくなる。
- 

### 4.1.1 シングルページアプリケーションとルーティング

- CHAPTER5の内容は特定のコンポーネント間の局所的なデータのやり取りだった。
- 対してVuexは特定のコンポーネント間だけでなく、アプリケーション全体でデータを共有する。
- P.154の図とP.253の図を見比べるとイメージしやすい。（*⌘＋Gで157、その後⌘＋Gで252*）

### 4.1.2 Vue Routerとは

- 省略
- インストール時のログは[ここ](https://github.com/yasugahira0810/vuejs_chapter8/blob/master/install.log)にあるので、もしインストール時にエラーが出た時は参考にしてください。

### *補足*

- *本章を読み進める上で、[Vuex入門](https://vuex.vuejs.org/ja/guide/)の冒頭も参考になるので引用する*


*Vuex アプリケーションの中心にあるものはストアです。"ストア" は、基本的にアプリケーションの 状態（state） を保持するコンテナです。単純なグローバルオブジェクトとの違いが 2つあります。*

*1. Vuex ストアはリアクティブです。Vue コンポーネントがストアから状態を取り出すとき、もしストアの状態が変化したら、ストアはリアクティブかつ効率的に更新を行います。*

*2. ストアの状態を直接変更することはできません。明示的にミューテーションをコミットすることによってのみ、ストアの状態を変更します。これによって、全ての状態の変更について追跡可能な記録を残すことが保証され、ツールでのアプリケーションの動作の理解を助けます。*

- *以降の節ではずっとストアの話が続くが、少なくとも本節を読む上ではVuexとほぼ同じものと捉えてよさそう。*
- *グローバルオブジェクトとの違いの2点目は、Fluxアーキテクチャのことを示しているっぽい。（よくわかっていない）*

-------------------

## 4.2 Vue Routerとは

- *コードの中身は次節で説明するので省略。画面は無しで、コンソールログに0と1が出力されるはず。*

### 4.2.1 ルーターのインストール

- 省略。

### 4.2.2 ルーティング設計

- Vue.js本体はthisを使う。P.60参照。メソッド内ではプロパティ名にthisをつける必要があって、このthisはインスタンスを指すという話があった。
- それに対してVuexのインスタンスはthisは使わず、プロパティやメソッドは引数として渡す。そのためメソッド定義にもアロー関数を使用できる。

-------------------

## 4.3 実践的なルーティングのための機能

### 4.3.1 URLパラメーターの扱いとパターンマッチング

- *P.258の図を理解することが本節で一番重要な気がする。*
- *WEB+DB PRESS Vol106の「仮想DOM革命」という記事に仮想DOMやFluxアーキテクチャのことが書いてあったので、（難しくて理解が曖昧だが）その内容を踏まえて補足する。*
- *P.258の図に、公式ドキュメントとWEB+DB PRESSの記事を併せて、自分なりの理解として図示したのが下の図。*

![Vuexアーキテクチャ](./vuex_architecture.png)

- *この図で大事なのはComponentがStateを更新したい場合、直接Stateを更新することはできず、間にあるActionsとMutationsを介さないといけないということっぽい。*
- *StateとComponentを双方向に通信させず、ComponentがStateを更新する場合はActionsとMutationsを介すアーキテクチャを取ることで、状態管理が複雑になる問題を解消しているらしい。*
- *Fluxというアーキテクチャが登場するまでは、サーバサイドMVCをクライアント側に適用したクライアントサイドMVCというアーキテクチャが使われていたが、この状態管理の複雑さが深刻な問題だったっぽい。*
- *図のようなアーキテクチャを単方向データフローというらしい。*
- *ストアの要素を「コンポーネントでいうと○○」と説明している箇所が多いので、SECTION06（P.43〜）でオプションの構成を確認しておくと理解しやすい。*

### 4.3.2 名前付きルート

- ストアで管理している状態そのもの。
- コンポーネントでいうところのdata。

### 4.3.3 router.pushを使った遷移

- stateを取得するための算出データ。
- コンポーネントでいうところのcomputed(算出プロパティ)とmethodsの中間のような機能。
- 算出プロパティとの違い
  + 引数を渡せる
  + セッター機能なし
  + 定義するメソッドの引数として使用できるプロパティやメソッドが受け取れる
- getterを介さず直接stateにアクセスすることもできるが、混乱を避けるため常にゲッターを介すのがおすすめ。（*やろうとすれば直接stateにアクセスできる？？？*）

### 4.3.4 フック関数

- ステートを変更できる唯一のメソッド。
- コンポーネントでいうところのmethods。
- ミューテーションおよびアクションのメソッドは「タイプ」と呼ばれる。

-------------------

## 4.4 サンプルアプリケーションの実装

- *前節までで学んだストアを、コンポーネントから利用するサンプルが以下の２通り掲載されている。*
  + バインドとイベントを使った場合
  + v-modelを使った場合
- ゲッターやミューテーションを複数使用するとき、算出プロパティやメソッドをすべて記述すると冗長なので、mapState, mapGettersといった名前のヘルパーが用意されている。

### 4.4.1 リストページの実装

### 4.4.2 APIによるデータ通信

### 4.4.3 詳細ページの実装

### 4.4.4 ユーザー登録ページの実装

### 4.4.5 ログイン・ログアウトの実装

### 4.4.6 サンプルアプリケーションの全体像

-------------------

## 4.5 Vue Routerの高度な機能

### モジュールの使い方&同一のミューテーションタイプ

- ストアで管理する情報が増えた場合、ストアを分割することができる。このとき使うのがストアのモジュールオプション。
- ステートはそれぞれのモジュールで管理され、ミューテーションおよびアクションは同一のタイプが定義できる。この場合にコミットをするとすべてのステートに対してタイプが実行される。

### ネームスペース

- 前節で説明した同一のタイプが一括コミットされるのは便利だが、使い分けしたいこともある。
- この場合は、モジュールを定義する際にnamespacedオプションをtrueに設定すればよい。

### モジュールのネスト

### ネームスペース付きモジュールから外部へのアクセス

-------------------

## SECTION46 その他のストアやオプション

### ストアの状態を監視する

### Strictモードで開発する

### Vuexでホットリロードを使用する

-------------------
